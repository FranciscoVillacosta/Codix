<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Agregar Producto</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { background: #eef2f7; font-family:"Segoe UI", sans-serif;}
header { background:#20c997; color:white; padding:1rem 2rem; border-radius:.75rem; box-shadow:0 4px 12px rgba(0,0,0,0.15); margin-bottom:2rem;}
.card { border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
</style>
</head>
<body>
<div class="container py-4">
<header class="d-flex justify-content-between align-items-center">
<h2><i class="bi bi-plus-circle"></i> Agregar Producto</h2>
<a href="index.html" class="btn btn-light btn-sm"><i class="bi bi-arrow-left"></i> Regresar</a>
</header>

<div class="card p-4">
<form id="formAgregar">
<div class="row g-3">
<div class="col-md-6">
<label for="codigo" class="form-label">Código</label>
<input type="text" id="codigo" class="form-control" placeholder="Ej: 001" required>
</div>
<div class="col-md-6">
<label for="nombre" class="form-label">Nombre</label>
<input type="text" id="nombre" class="form-control" placeholder="Ej: Café" required>
</div>
<div class="col-md-6">
<label for="categoria" class="form-label">Categoría</label>
<select id="categoria" class="form-select" required>
<option value="">Seleccionar...</option>
<option>Bebidas</option>
<option>Comida</option>
<option>Snacks</option>
<option>Otros</option>
</select>
</div>
<div class="col-md-3">
<label for="precio" class="form-label">Precio</label>
<div class="input-group">
<span class="input-group-text">$</span>
<input type="number" id="precio" class="form-control" min="0" step="0.01" required>
</div>
</div>
<div class="col-md-3">
<label for="stock" class="form-label">Stock</label>
<input type="number" id="stock" class="form-control" min="0" required>
</div>
</div>

<div class="d-flex justify-content-end mt-4">
<button type="reset" class="btn btn-outline-secondary me-2"><i class="bi bi-x-circle"></i> Limpiar</button>
<button type="submit" class="btn btn-success"><i class="bi bi-check-circle"></i> Guardar</button>
</div>
<div id="msg" class="mt-3"></div>
</form>
</div>
</div>

<script>
let db;
const request = indexedDB.open("punto_venta_db",1);

request.onupgradeneeded = function(e){
  db = e.target.result;
  if(!db.objectStoreNames.contains("productos")){
    const store = db.createObjectStore("productos",{keyPath:"codigo"});
    store.createIndex("nombre","nombre",{unique:false});
  }
  if(!db.objectStoreNames.contains("ventas")){
    db.createObjectStore("ventas",{keyPath:"id", autoIncrement:true});
  }
};

request.onsuccess = function(e){ db = e.target.result; };
request.onerror = function(e){ console.error("Error DB:",e); };

document.getElementById("formAgregar").addEventListener("submit", function(e){
e.preventDefault();
const codigo = document.getElementById("codigo").value.trim();
const nombre = document.getElementById("nombre").value.trim();
const categoria = document.getElementById("categoria").value;
const precio = parseFloat(document.getElementById("precio").value);
const stock = parseInt(document.getElementById("stock").value);

if(!codigo || !nombre || !categoria) return;

const tx = db.transaction("productos","readwrite");
const store = tx.objectStore("productos");
store.put({codigo,nombre,categoria,precio,stock});

tx.oncomplete = function(){ 
document.getElementById("msg").innerHTML = '<div class="alert alert-success">Producto agregado ✅</div>';
document.getElementById("formAgregar").reset();
};
tx.onerror = function(e){ console.error(e); document.getElementById("msg").innerHTML = '<div class="alert alert-danger">Error al guardar</div>'; };
});
</script>
</body>
</html>
